import*as e from"three";class t{constructor(e){this.app=e,this.tasks=[]}add(e){this.tasks.push(e)}animate(){requestAnimationFrame(this.animate.bind(this)),this.tasks.forEach((e=>e())),this.app.render()}}class s{constructor(e,t){this.app=e,this.THREE=e.THREE,this.settings={load:()=>{this.app.init()},progress:(e,t,s)=>{},gltfExtensions:[".gltf",".glb"],objExtensions:[".obj"],textureExtensions:[".jpg",".jpeg",".png",".gif",".bmp",".tga"],...t},this.manager=new this.THREE.LoadingManager((()=>this.settings.load()),((e,t,s)=>this.settings.progress(e,t,s))),this.setUpLoaders()}setUpLoaders(){this.TextureLoader=!1,this.GLTFLoader=!1,this.OBJLoader=!1,this.app.settings.GLTFLoader&&(this.GLTFLoader=new this.app.settings.GLTFLoader(this.manager)),this.app.settings.OBJLoader&&(this.OBJLoader=new this.app.settings.OBJLoader(this.manager)),this.TextureLoader=new this.THREE.TextureLoader(this.manager)}load(){for(const e in this.app.settings.preload){let t=this.app.settings.preload[e];this.endsWith(t,this.settings.gltfExtensions)&&(this.GLTFLoader?this.GLTFLoader.load(t,(t=>{this.app[e]=t.scene})):console.warn(`ThreeasyLoader: GLTFLoader is not defined trying to load: ${t}`)),this.endsWith(t,this.settings.objExtensions)&&(this.OBJLoader?this.OBJLoader.load(t,(t=>{this.app[e]=t})):console.warn(`ThreeasyLoader: OBJLoader is not defined trying to load: ${t}`)),this.endsWith(t,this.settings.textureExtensions)&&this.TextureLoader.load(t,(t=>{this.app[e]=t,this.setUpTexture(this.app[e])}))}}endsWith(e,t){return t.some((t=>e.endsWith(t)))}setUpTexture(e){e.encoding=this.THREE.sRGBEncoding,e.wrapT=this.THREE.RepeatWrapping,e.wrapS=this.THREE.RepeatWrapping}}class i{constructor(e){this.app=e,this.tasks=[]}add(e){this.tasks.push(e)}load(){this.tasks.forEach((e=>e()))}}class n{constructor(t){this.app=t,this.clicks=[],this.hovers=[],this.app.settings.interactions&&(this.raycaster=new e.Raycaster,this.pointer=new e.Vector2,this.app.mouse=this.pointer,this.interactions())}noInteractions=()=>0==this.clicks.length&&0==this.hovers.length;interactions(){this.app.animator.add((()=>{this.noInteractions()||(this.raycaster.setFromCamera(this.pointer,this.app.camera),this.intersects=[],this.intersects=this.raycaster.intersectObjects(this.app.scene.children))})),this.app.renderer.domElement.addEventListener("mousemove",(e=>{this.noInteractions()||(this.calculatePosition(e),this.calculateIntersects("mouseMove",e))})),this.app.renderer.domElement.addEventListener("click",(e=>{this.noInteractions()||(this.calculatePosition(e),this.calculateIntersects("click",e))})),this.app.renderer.domElement.addEventListener("mouseup",(e=>{this.noInteractions()||(this.calculatePosition(e),this.calculateIntersects("mouseup",e))}))}calculatePosition(){this.pointer.x=event.clientX/window.innerWidth*2-1,this.pointer.y=-(event.clientY/window.innerHeight*2-1)}calculateIntersects(e,t){let s=[];for(let i=0;i<this.intersects.length;i++){const n=this.intersects[i];if(s.push(n.object.uuid),"click"==e){const e=this.clicks.find((e=>n.object.uuid==e.el.uuid));e&&e.fn(t,n)}}"mouseMove"==e&&this.hovers.forEach((e=>{const i=s.indexOf(e.el.uuid)>-1,n=e.el.hovered;i&&!n&&(e.el.hovered=!0,e.fns.enter&&e.fns.enter(t,e.el)),!i&&n&&(e.el.hovered=!1,e.fns.leave&&e.fns.leave(t,e.el))}))}onClick(e,t){this.clicks.push({el:e,fn:t})}onHover(e,t){e.hovered=!1,this.hovers.push({el:e,fns:t})}}class h{constructor(e,h){if(this.settings={light:!0,alpha:!1,interactions:!1,domElement:document.body,...h},!this.settings.domElement)throw new Error("Threeasy: settings.domElement not found.");this.THREE=e,this.setSize(),this.animator=new t(this),this.scene=new e.Scene,this.camera=new e.PerspectiveCamera(75,this.sizes.w/this.sizes.h,1,200),this.camera.position.x=0,this.camera.position.y=0,this.camera.position.z=2,this.scene.add(this.camera),this.renderer=new e.WebGLRenderer({antialias:!0,alpha:this.settings.alpha}),this.renderer.setSize(this.sizes.w,this.sizes.h),this.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio)),this.renderer.shadowMap.enabled=!0,this.renderer.shadowMap.type=e.PCFSoftShadowMap,this.mouse={x:null,y:null},this.interactions=new n(this),this.models={},this.textures={},this.loader=new s(this),this.postLoader=new i(this),this.settings.light&&(this.light=new e.AmbientLight(16777215,1),this.scene.add(this.light)),this.clock=new e.Clock,this.clock.start(),this.settings.domElement.appendChild(this.renderer.domElement),this.resizeObserver=new ResizeObserver((e=>this.resize())),this.resizeObserver.observe(this.settings.domElement),this.preload()}setSize(){let e=this.settings.domElement.getBoundingClientRect();this.settings.domElement===document.body&&(e={width:window.innerWidth,height:window.innerHeight}),this.sizes={w:e.width,h:e.height}}preload(){this.settings.preload?this.loader.load():this.init()}postload(e){this.postLoader.add(e)}render(){this.renderer.render(this.scene,this.camera)}animate(e){this.animator.add(e)}init(){this.postLoader.load(),this.animator.animate()}resize(){console.log("resizing"),this.setSize(),this.camera.aspect=this.sizes.w/this.sizes.h,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.sizes.w,this.sizes.h),this.renderer.setPixelRatio(Math.min(2,window.devicePixelRatio))}onWindowResize(){console.log("onWindowResize"),this.resize()}}export{h as default};
